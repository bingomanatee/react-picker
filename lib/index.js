!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("prop-types"),require("@wonderlandlabs/looking-glass-engine"),require("lodash.isequal")):"function"==typeof define&&define.amd?define(["react","prop-types","@wonderlandlabs/looking-glass-engine","lodash.isequal"],t):(e=e||self).LGE=t(e.React,e.PropTypes,e.lookingGlassEngine,e.isEqual)}(this,(function(e,t,n,o){"use strict";var r="default"in e?e.default:e;function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=f(e);if(t){var r=f(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return y(this,n)}}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var c,a=e[Symbol.iterator]();!(o=(c=a.next()).done)&&(n.push(c.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw i}}return n}(e,t)||b(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}t=t&&t.hasOwnProperty("default")?t.default:t,o=o&&o.hasOwnProperty("default")?o.default:o;var O=r.createContext({});function g(t){return e.createElement("svg",u({width:24,height:24},t),e.createElement("rect",{x:1,y:1,width:20,height:20,rx:6,transform:"translate(1 1)",fill:"#FFF",stroke:"#D6D6D6",strokeWidth:2,fillRule:"evenodd"}))}function C(t){return e.createElement("svg",u({width:24,height:24},t),e.createElement("g",{fill:"none",fillRule:"evenodd"},e.createElement("rect",{x:1,y:1,width:20,height:20,rx:6,transform:"translate(1 1)",fill:"#FFF",stroke:"#D6D6D6",strokeWidth:2}),e.createElement("path",{d:"M23 7v2.114L11.494 20.619 7.96 17.084l.366-.367-5.872-5.87L5.99 7.31l5.871 5.87 9.872-9.87A5.974 5.974 0 0123 7z",fill:"#335F00"})))}function E(t){return e.createElement("svg",u({width:24,height:24},t),e.createElement("circle",{cx:11,cy:11,r:10,transform:"translate(0 1)",fill:"#FFF",stroke:"#D6D6D6",strokeWidth:2,fillRule:"evenodd"}))}function k(t){return e.createElement("svg",u({width:24,height:24},t),e.createElement("g",{fill:"none",fillRule:"evenodd"},e.createElement("circle",{cx:11,cy:11,r:10,transform:"translate(1 1)",fill:"#FFF",stroke:"#D6D6D6",strokeWidth:2}),e.createElement("path",{d:"M20.734 5.311a10.947 10.947 0 012.128 4.942L11.495 21.619 7.96 18.084l.366-.367-5.872-5.87L5.99 8.31l5.871 5.87z",fill:"#417505"})))}var w=function(t){var n,o=t.active,i=t.children,c=t.onClick,a=e.useContext(O).store;return n=o?a.my.chooseOne?k:C:a.my.chooseOne?E:g,r.createElement("div",{className:"picker__item",active:o,onClick:c},r.createElement(n,null),r.createElement("label",null,i))};w.propTypes={active:t.bool,children:t.any,onClick:t.func},w.defaultProps={active:!1};var j=function(e){var t=e.children;return r.createElement("p",{className:"picker__empty"},t||"no options")},S=function(t){var n=t.Item,o=t.ChoiceMenu,i=t.EmptyMessage,c=e.useContext(O),a=c.value,l=c.store;if(!a)return"";if(!a.display)return"";n||(n=w);var u=l.my.optionsFilter(a.options,a,l);return u&&u.length?r.createElement(o,null,u.map((function(e,t){var o=a.choices.some((function(t){return l.my.comparator(t,e)})),i=l.my.optionToLabel(e,t,l);return r.createElement(n,{key:"".concat(i,"_").concat(t),store:l,active:o,option:e,onClick:function(){return l.do.chooseOption(e)}},i)}))):r.createElement(o,null,i?r.createElement(i,{onClick:function(){return l.do.setDisplay(!1)}},"No Choices"):r.createElement(j,null,"--- no choices ---"))};S.propTypes={Item:t.elementType};var P=function(e){var t=e.children;return r.createElement("section",{className:"picker__container"},t)};P.propTypes={children:t.any};var T=function(e){if("string"==typeof e||"number"==typeof e)return e;if("object"===i(e)){if("label"in e)return e.label;if("function"==typeof e.toString)return e.toString()}return"".concat(e)},D=function(e,t,n){return e&&"function"==typeof e[t]?e[t]:n},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=D(e,"optionsFilter",(function(e){return d(e)})),r=D(e,"optionToChoice",(function(e){return e})),i=D(e,"comparator",o),c=D(e,"optionToLabel",T),a=new n.ValueStoreObject({options:e.options||[],choices:e.choices||[],display:!!e.display,chooseOne:!!e.chooseOne,comparator:i,optionsFilter:t,optionToChoice:r,optionToLabel:c,closeOnClick:!!e.closeOnClick},{actions:{chooseOption:function(e,t){if(e.my.chooseOne){var n=e.my.optionToChoice(t);e.do.setChoices([n])}else e.do.toggleOption(t)},addOption:function(e,t){var n=e.my.optionToChoice(t);e.my.chooseOne?e.do.setChoices([n]):e.my.choices.some((function(t){return e.my.comparator(t,n)}))||e.do.setChoices([].concat(d(e.my.choices),[n]))},toggleOption:function(e,t){var n=e.my.optionToChoice(t);e.my.choices.some((function(t){return e.my.comparator(t,n)}))?e.my.chooseOne?e.do.setChoices([]):e.do.setChoices(e.my.choices.filter((function(t){return!e.my.comparator(t,n)}))):e.my.chooseOne?e.do.setChoices([n]):e.do.setChoices([].concat(d(e.my.choices),[n]))},toggleDisplay:function(e){e.do.setDisplay(!e.my.display)},addAll:function(e){e.do.setChoices(d(e.my.options))},remAll:function(e){e.do.setChoices([])}}});return a},M=function(e){e.stopPropagation()},x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(l,e);var t,n,o,i=m(l);function l(){return c(this,l),i.apply(this,arguments)}return t=l,(n=[{key:"render",value:function(){return r.createElement("span",{onPointerDown:M},this.props.children)}}])&&a(t.prototype,n),o&&a(t,o),l}(e.PureComponent),_=function(t){var n=t.store,o=t.children,i=e.useRef(null),c=e.useCallback((function(){n.my.display&&n.do.setDisplay(!1)})),a=e.useCallback((function(e){"Escape"===e.key&&c()}),[]),l=e.useCallback((function(e){if(i.current&&!i.current.contains(e.target)){for(var t=e.target;t;){if("svg"===t.nodeName)return;if(t.dataset&&t.dataset.closer)return;t=t.parentNode||t.parent}c()}}),[i.current]);return e.useEffect((function(){return setTimeout((function(){document.addEventListener("click",l),document.addEventListener("keyup",a)}),500),function(){document.removeEventListener("click",l),document.removeEventListener("keyup",a)}}),[]),r.createElement("div",{"data-closer":!0,ref:i},o)},A=function(t){var n=h(e.useState(!1),2),o=n[0],i=n[1],c=h(e.useState(null),2),a=c[0],u=c[1];e.useEffect((function(){var e=F(t);t.onStore&&t.onStore(e),i(e);var n,o=e.subscribe(u,(function(e){return console.log("picker store error:",e)}));return t.onChoices&&(n=e.watch("choices").subscribe((function(e){var n=e.choices;return t.onChoices(n)}))),function(){o.unsubscribe(),n&&n.unsubscribe(),e.complete()}}),[]);var f=t.display,p=t.options,y=t.comparator,m=t.filterOptions;e.useEffect((function(){o&&"display"in t&&!!t.display!=!!o.my.display&&o.do.setDisplay(!!t.display)}),[f,o]),e.useEffect((function(){o&&Array.isArray(t.options)&&o.do.setOptions(t.options)}),[p,o]),e.useEffect((function(){o&&"function"==typeof y&&o.do.setComparator(y)}),[y,o]),e.useEffect((function(){o&&"function"==typeof m&&o.do.setFilterOptions(m)}),[m,o]);var d=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({ChoiceItem:w,ChoiceMenu:P,ChoiceContainer:S,EmptyMessage:j},t),b=d.ChoiceContainer,v=d.ChoiceMenu,g=d.ChoiceItem,C=d.EmptyMessage;if(!o||!a)return"";return r.createElement(O.Provider,{value:{value:a,store:o}},r.createElement(x,null,"function"==typeof t.children?t.children({value:a,store:o}):t.children,function(e){return e.my.display?e.my.closeOnClick?r.createElement(_,{store:e},r.createElement(b,{Item:g,ChoiceMenu:v,EmptyMessage:C})):r.createElement(b,{Item:g,ChoiceMenu:v,EmptyMessage:C}):""}(o)))};return A.propTypes={ChoiceContainer:t.elementType,ChoiceItem:t.elementType,ChoiceMenu:t.elementType,EmptyMessage:t.elementType,options:t.arrayOf(t.oneOfType([t.string,t.shape({label:t.string})])),onChoices:t.func,onStore:t.func,display:t.bool,chooseOne:t.bool,filterOptions:t.func,comparator:t.func,optionToLabel:t.func,optionToChoice:t.func,children:t.any,closeOnClick:t.bool},A.defaultProps={options:[],closeOnClick:!1,display:!1,chooseOne:!1,onStore:null,onChoices:null},{Picker:A,ChoiceContext:O,CheckOn:C,CheckOff:g,RadioOn:k,RadioOff:E,choiceState:F,ChoiceItem:w,EmptyMessage:j}}));
